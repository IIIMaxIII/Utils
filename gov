#!/bin/bash
# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ CPU governor –∏ —á–∞—Å—Ç–æ—Ç–æ–π (–≤–µ—Ä—Å–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)

# === –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–≤–µ—Ç–æ–≤ –∏ –∏–∫–æ–Ω–æ–∫ ===
RED='\033[0;31m'; GREEN='\033[0;32m'; YELLOW='\033[1;33m'
BLUE='\033[0;34m'; CYAN='\033[0;36m'; NC='\033[0m'
ICON_CPU="üíª"; ICON_PERF="üöÄ"; ICON_SAVE="üîã"; ICON_ADAPT="‚ö°"

# === –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π ===
if [[ $EUID -ne 0 ]]; then
    echo -e "${RED}√ó${NC} –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ root. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: ${YELLOW}sudo $0${NC}"
    exit 1
fi

# === –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö governor ===
AVAILABLE_GOVERNORS=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors 2>/dev/null)

# === –§—É–Ω–∫—Ü–∏–∏ ===

set_governor() {
    local mode=$1 icon=$2 name=$3
    echo -e "${icon} –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é —Ä–µ–∂–∏–º: ${GREEN}${name}${NC}"
    for cpu in /sys/devices/system/cpu/cpu[0-9]*; do
        echo "$mode" > "$cpu/cpufreq/scaling_governor" 2>/dev/null
    done
    echo -e "${GREEN}‚úî${NC} Governor —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ${YELLOW}${mode}${NC}"
}

set_frequency() {
    local freq_mhz=$1
    local freq_khz=$((freq_mhz * 1000))
    echo -e "üéØ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —á–∞—Å—Ç–æ—Ç—É: ${GREEN}${freq_mhz} MHz${NC}"
    for cpu in /sys/devices/system/cpu/cpu[0-9]*; do
        echo userspace > "$cpu/cpufreq/scaling_governor" 2>/dev/null
        echo "$freq_khz" > "$cpu/cpufreq/scaling_setspeed" 2>/dev/null
    done
    echo -e "${GREEN}‚úî${NC} –ß–∞—Å—Ç–æ—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: ${YELLOW}${freq_mhz} MHz${NC}"
}

show_current() {
    local governors current_governor cores threads total freq_unique freq_total

    governors=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors 2>/dev/null)
    current_governor=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor 2>/dev/null)

    cores=$(lscpu | awk '/^Core\(s\) per socket:/ {print $4}')
    threads=$(lscpu | awk '/^Thread\(s\) per core:/ {print $4}')
    total=$(lscpu | awk '/^CPU\(s\):/ {print $2}')

    freq_unique=$(grep "cpu MHz" /proc/cpuinfo | awk '{print int($4/100)*100}' | sort -u)
    freq_total=$(grep "cpu MHz" /proc/cpuinfo | awk '{sum+=$4} END {printf "%.1f", sum/NR/1000}')

    echo -e "${CYAN}${ICON_CPU} –°–æ—Å—Ç–æ—è–Ω–∏–µ CPU${NC}"
    echo -e "${BLUE}‚îú‚îÄ‚îÄ –î–æ—Å—Ç—É–ø–Ω—ã–µ:${NC} ${YELLOW}${governors}${NC}"
    echo -e "${BLUE}üìä –¢–µ–∫—É—â–∏–π:${NC} ${GREEN}${current_governor}${NC}"
    echo -e "${BLUE}‚îú‚îÄ‚îÄ –¢–æ–ø–æ–ª–æ–≥–∏—è:${NC} ${YELLOW}${cores}${NC} —è–¥–µ—Ä √ó ${YELLOW}${threads}${NC} –ø–æ—Ç–æ–∫–∞ = ${GREEN}${total}${NC} –ø–æ—Ç–æ–∫–æ–≤"

    if [[ $(echo "$freq_unique" | wc -l) -eq 1 ]]; then
        echo -e "${BLUE}‚îî‚îÄ‚îÄ –ß–∞—Å—Ç–æ—Ç—ã –ø–æ—Ç–æ–∫–æ–≤:${NC}"
        echo -e "   –í—Å–µ @ ${GREEN}${freq_total} GHz${NC}"
    else
        echo -e "${BLUE}‚îî‚îÄ‚îÄ –ß–∞—Å—Ç–æ—Ç—ã –ø–æ—Ç–æ–∫–æ–≤:${NC}"
        for f in $freq_unique; do
            echo -e "   ${GREEN}${f} MHz${NC}"
        done
    fi
}

show_help() {
    echo -e "${CYAN}–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:${NC} sudo $0 [—Ä–µ–∂–∏–º|—á–∞—Å—Ç–æ—Ç–∞]"
    echo
    echo -e "${GREEN}–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã:${NC}"
    echo -e "  ${GREEN}-p, --performance${NC}   - üöÄ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"
    echo -e "  ${GREEN}-e, --powersave${NC}     - üîã –≠–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏–µ"
    echo -e "  ${GREEN}-o, --ondemand${NC}      - ‚ö° –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º"
    echo -e "  ${GREEN}-s, --schedutil${NC}     - ‚ö° –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π"
    echo -e "  ${GREEN}-c, --current${NC}       - üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"
    echo
    echo -e "${GREEN}–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–æ—Ç—ã:${NC}"
    echo -e "  ${GREEN}2000${NC}                - üéØ 2.0 GHz (—ç–∫–æ–Ω–æ–º–Ω—ã–π)"
    echo -e "  ${GREEN}2400${NC}                - üéØ 2.4 GHz (–±–∞–∑–æ–≤–∞—è)"
     echo -e "  ${GREEN}–õ—é–±–æ–µ —á–∏—Å–ª–æ${NC}         - üéØ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–∞—Å—Ç–æ—Ç—ã –≤ –ú–ì—Ü"
    echo
    echo -e "${YELLOW}–ü—Ä–∏–º–µ—Ä—ã:${NC}"
    echo -e "  sudo $0 2400           # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 2.4 GHz"
    echo -e "  sudo $0 -p             # –†–µ–∂–∏–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
    echo -e "  sudo $0 --current      # –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"
}

# === –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ ===
GOVERNOR="$1"

case "${GOVERNOR}" in
    "-p"|"--performance")
        set_governor "performance" "${ICON_PERF}" "–ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨"
        ;;
    "-e"|"--powersave")
        set_governor "powersave" "${ICON_SAVE}" "–≠–ù–ï–†–ì–û–°–ë–ï–†–ï–ñ–ï–ù–ò–ï"
        ;;
    "-o"|"--ondemand")
        set_governor "ondemand" "${ICON_ADAPT}" "–ê–î–ê–ü–¢–ò–í–ù–´–ô –†–ï–ñ–ò–ú"
        ;;
    "-s"|"--schedutil")
        set_governor "schedutil" "${ICON_ADAPT}" "–°–û–í–†–ï–ú–ï–ù–ù–´–ô –ê–î–ê–ü–¢–ò–í–ù–´–ô"
        ;;
    "-c"|"--current"|"" )
        show_current
        ;;
    "--help"|"-h")
        show_help
        ;;
    *)
        if [[ "${GOVERNOR}" =~ ^[0-9]+$ ]]; then
            set_frequency "${GOVERNOR}"
        else
            echo -e "${RED}√ó${NC} –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–µ–∂–∏–º: ${GOVERNOR}"
            echo -e "${YELLOW}‚Ñπ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:${NC} sudo $0 --help"
        fi
        ;;
esac
