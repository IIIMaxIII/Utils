#!/bin/bash

# –¶–≤–µ—Ç–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m' # –ë–µ–∑ —Ü–≤–µ—Ç–∞

# –ò–∫–æ–Ω–∫–∏
ICON_CPU="üß†"
ICON_PERF="üöÄ"
ICON_SAVE="üîã"
ICON_ADAPT="‚ö°"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
if [[ $EUID -ne 0 ]]; then
    echo -e "${RED}√ó${NC} –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—Å–∫ –æ—Ç root (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ sudo)."
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–∞
if [[ -z "$1" ]]; then
    echo -e "${YELLOW}‚Ñπ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:${NC} sudo $0 [—Ä–µ–∂–∏–º|—á–∞—Å—Ç–æ—Ç–∞]"
    echo -e "–î–ª—è —Å–ø—Ä–∞–≤–∫–∏: sudo $0 --help"
    exit 1
fi

GOVERNOR="$1"

# –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö governor'–æ–≤
AVAILABLE_GOVERNORS=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors 2>/dev/null)

# –§—É–Ω–∫—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ governor
set_governor() {
    local mode="$1"
    local icon="$2"
    local label="$3"
    if [[ $AVAILABLE_GOVERNORS == *"$mode"* ]]; then
        echo -e "${CYAN}${ICON_CPU} –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é —Ä–µ–∂–∏–º: ${icon} ${label}${NC}"
        for cpu in /sys/devices/system/cpu/cpu[0-9]*; do
            echo "$mode" > "$cpu/cpufreq/scaling_governor" 2>/dev/null || true
        done
        echo -e "${GREEN}‚úî –†–µ–∂–∏–º '${mode}' –ø—Ä–∏–º–µ–Ω—ë–Ω.${NC}"
    else
        echo -e "${RED}√ó –†–µ–∂–∏–º '${mode}' –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º–µ.${NC}"
        echo -e "${BLUE}–î–æ—Å—Ç—É–ø–Ω—ã–µ:${NC} ${YELLOW}${AVAILABLE_GOVERNORS}${NC}"
    fi
}

# –ü–æ–∫–∞–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
show_current() {
    for cpu in /sys/devices/system/cpu/cpu[0-9]*; do
        gov=$(cat "$cpu/cpufreq/scaling_governor" 2>/dev/null)
        freq=$(awk '{printf "%.1f", $1/1000}' "$cpu/cpufreq/scaling_cur_freq" 2>/dev/null)
        echo -e "${BLUE}‚îú‚îÄ‚îÄ ${cpu##*/}:${NC} ${YELLOW}${gov}${NC} (${freq} –ú–ì—Ü)"
    done
}

# –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
case "${GOVERNOR}" in
    "-p"|"--performance")
        set_governor "performance" "${ICON_PERF}" "–ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨"
        ;;
    "-e"|"--powersave")
        set_governor "powersave" "${ICON_SAVE}" "–≠–ù–ï–†–ì–û–°–ë–ï–†–ï–ñ–ï–ù–ò–ï"
        ;;
    "-o"|"--ondemand")
        set_governor "ondemand" "${ICON_ADAPT}" "–ê–î–ê–ü–¢–ò–í–ù–´–ô –†–ï–ñ–ò–ú"
        ;;
    "-s"|"--schedutil")
        set_governor "schedutil" "${ICON_ADAPT}" "–°–û–í–†–ï–ú–ï–ù–ù–´–ô –ê–î–ê–ü–¢–ò–í–ù–´–ô"
        ;;
    "-c"|"--current")
        echo -e "${CYAN}${ICON_CPU} –°–æ—Å—Ç–æ—è–Ω–∏–µ CPU${NC}"
        echo -e "${BLUE}‚îú‚îÄ‚îÄ –î–æ—Å—Ç—É–ø–Ω—ã–µ: ${YELLOW}${AVAILABLE_GOVERNORS}${NC}"
        show_current
        ;;
    "--help"|"-h")
        echo -e "${CYAN}–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:${NC} sudo $0 [—Ä–µ–∂–∏–º|—á–∞—Å—Ç–æ—Ç–∞]"
        echo
        echo -e "${GREEN}–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã:${NC}"
        echo -e "  ${GREEN}-p, --performance${NC}   - üöÄ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"
        echo -e "  ${GREEN}-e, --powersave${NC}     - üîã –≠–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏–µ"
        echo -e "  ${GREEN}-o, --ondemand${NC}      - ‚ö° –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º"
        echo -e "  ${GREEN}-s, --schedutil${NC}     - ‚ö° –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π"
        echo -e "  ${GREEN}-c, --current${NC}       - üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"
        echo
        echo -e "${GREEN}–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–æ—Ç—ã:${NC}"
        echo -e "  ${GREEN}2400${NC}                - üéØ 2.4 GHz (–±–∞–∑–æ–≤–∞—è —á–∞—Å—Ç–æ—Ç–∞)"
        echo -e "  ${GREEN}2800${NC}                - üéØ 2.8 GHz"
        echo -e "  ${GREEN}3200${NC}                - üéØ 3.2 GHz"
        echo -e "  ${GREEN}2000${NC}                - üéØ 2.0 GHz (—ç–∫–æ–Ω–æ–º–Ω—ã–π)"
        echo -e "  ${GREEN}–õ—é–±–æ–µ —á–∏—Å–ª–æ${NC}         - üéØ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–∞—Å—Ç–æ—Ç—ã –≤ –ú–ì—Ü"
        echo
        echo -e "${YELLOW}–ü—Ä–∏–º–µ—Ä—ã:${NC}"
        echo -e "  sudo $0 2400           # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 2.4 GHz"
        echo -e "  sudo $0 2800000        # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 2.8 GHz (–≤ –∫–ì—Ü)"
        echo -e "  sudo $0 -p             # –†–µ–∂–∏–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
        echo -e "  sudo $0 --powersave    # –†–µ–∂–∏–º —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏—è"
        echo -e "  sudo $0 --current      # –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"
        ;;
    *)
        # –ü—Ä–æ–≤–µ—Ä–∫–∞: —á–∏—Å–ª–æ –ª–∏ –∞—Ä–≥—É–º–µ–Ω—Ç (—É—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–∞—Å—Ç–æ—Ç—ã)
        if [[ "$GOVERNOR" =~ ^[0-9]+$ ]]; then
            FREQ_KHZ="$((GOVERNOR * 1000))"
            echo -e "${CYAN}${ICON_CPU} –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é —á–∞—Å—Ç–æ—Ç—É: ${YELLOW}${GOVERNOR} –ú–ì—Ü${NC}"
            for cpu in /sys/devices/system/cpu/cpu[0-9]*; do
                echo "$FREQ_KHZ" > "$cpu/cpufreq/scaling_min_freq" 2>/dev/null || true
                echo "$FREQ_KHZ" > "$cpu/cpufreq/scaling_max_freq" 2>/dev/null || true
            done
            echo -e "${GREEN}‚úî –ß–∞—Å—Ç–æ—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.${NC}"
        else
            echo -e "${RED}√ó${NC} –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–µ–∂–∏–º: ${GOVERNOR}"
            echo -e "${YELLOW}‚Ñπ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:${NC}"
            echo -e "  –ö–æ—Ä–æ—Ç–∫–∏–µ: ${GREEN}-p, -e, -o, -s, -c${NC}"
            echo -e "  –î–ª–∏–Ω–Ω—ã–µ:  ${GREEN}--performance, --powersave, --ondemand, --schedutil, --current${NC}"
            echo -e "  –ß–∏—Å–ª–æ:    ${GREEN}2400, 2800, 3200 –∏ —Ç.–¥.${NC}"
            echo -e "${YELLOW}‚Ñπ –ü–æ–¥—Ä–æ–±–Ω–µ–µ:${NC} sudo $0 --help"
        fi
        ;;
esac
