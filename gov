#!/bin/bash
# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ CPU governor –∏ —á–∞—Å—Ç–æ—Ç–æ–π (ASCII –≤–µ—Ä—Å–∏—è, —á–∏—Å—Ç—ã–π –≤—ã–≤–æ–¥)

# === –¶–≤–µ—Ç–∞ ===
RED='\033[0;31m'; GREEN='\033[0;32m'; YELLOW='\033[1;33m'
BLUE='\033[0;34m'; CYAN='\033[0;36m'; NC='\033[0m'

# === –ü—Ä–æ–≤–µ—Ä–∫–∞ root ===
if [[ $EUID -ne 0 ]]; then
    echo -e "${RED}√ó${NC} –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ root. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: ${YELLOW}sudo $0${NC}"
    exit 1
fi

# === –î–æ—Å—Ç—É–ø–Ω—ã–µ governor ===
AVAILABLE_GOVERNORS=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors 2>/dev/null)

# === –§—É–Ω–∫—Ü–∏–∏ ===

set_governor() {
    local mode=$1 name=$2
    echo -e "‚ö° –£—Å—Ç–∞–Ω–æ–≤–∫–∞: ${GREEN}${name}${NC}"
    for cpu in /sys/devices/system/cpu/cpu[0-9]*; do
        echo "$mode" > "$cpu/cpufreq/scaling_governor" 2>/dev/null
    done
    echo -e "üìä –¢–µ–∫—É—â–∏–π: ${YELLOW}${mode}${NC}"
}

set_frequency() {
    local freq_mhz=$1
    local freq_khz=$((freq_mhz * 1000))
    echo -e "üéØ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–∞—Å—Ç–æ—Ç—ã: ${GREEN}${freq_mhz} MHz${NC}"
    for cpu in /sys/devices/system/cpu/cpu[0-9]*; do
        echo userspace > "$cpu/cpufreq/scaling_governor" 2>/dev/null
        echo "$freq_khz" > "$cpu/cpufreq/scaling_setspeed" 2>/dev/null
    done
    echo -e "üìä –¢–µ–∫—É—â–∞—è —á–∞—Å—Ç–æ—Ç–∞: ${YELLOW}${freq_mhz} MHz${NC}"
}

show_current() {
    local governors current_governor cores threads total
    governors=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors 2>/dev/null)
    current_governor=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor 2>/dev/null)
    cores=$(lscpu | awk '/^Core\(s\) per socket:/ {print $4}')
    threads=$(lscpu | awk '/^Thread\(s\) per core:/ {print $4}')
    total=$(lscpu | awk '/^CPU\(s\):/ {print $2}')

    echo -e "üìä –¢–µ–∫—É—â–∏–π: ${YELLOW}${current_governor}${NC}"
    echo -e "‚îú‚îÄ‚îÄ –¢–æ–ø–æ–ª–æ–≥–∏—è: ${YELLOW}${cores}${NC} —è–¥–µ—Ä √ó ${YELLOW}${threads}${NC} –ø–æ—Ç–æ–∫–∞ = ${GREEN}${total}${NC} –ø–æ—Ç–æ–∫–æ–≤"
    echo -e "‚îî‚îÄ‚îÄ –ß–∞—Å—Ç–æ—Ç—ã –ø–æ—Ç–æ–∫–æ–≤:"

    # –ß–∞—Å—Ç–æ—Ç—ã –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ –Ω–∞ –∫–∞–∂–¥–æ–π
    grep "cpu MHz" /proc/cpuinfo | awk '{
        freq=int($4/100+0.5)/10; count[freq]++
    } END {
        for (f in count) printf "   %d @ %.1f GHz\n", count[f], f
    }' | sort -n -k3
}

show_help() {
    echo -e "${CYAN}–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:${NC} sudo $0 [—Ä–µ–∂–∏–º|—á–∞—Å—Ç–æ—Ç–∞]"
    echo
    echo -e "${GREEN}–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã:${NC}"
    echo -e "  -p, --performance   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"
    echo -e "  -e, --powersave     - –≠–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏–µ"
    echo -e "  -o, --ondemand      - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º"
    echo -e "  -s, --schedutil     - –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π"
    echo -e "  -c, --current       - –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ"
    echo
    echo -e "${GREEN}–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–æ—Ç—ã:${NC}"
    echo -e "  2000, 2400, 2800, 3200 ‚Äî —á–∞—Å—Ç–æ—Ç–∞ –≤ –ú–ì—Ü"
}

# === –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ ===
GOVERNOR="$1"

case "${GOVERNOR}" in
    "-p"|"--performance")
        set_governor "performance" "–ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨"
        ;;
    "-e"|"--powersave")
        set_governor "powersave" "–≠–ù–ï–†–ì–û–°–ë–ï–†–ï–ñ–ï–ù–ò–ï"
        ;;
    "-o"|"--ondemand")
        set_governor "ondemand" "–ê–î–ê–ü–¢–ò–í–ù–´–ô –†–ï–ñ–ò–ú"
        ;;
    "-s"|"--schedutil")
        set_governor "schedutil" "–°–û–í–†–ï–ú–ï–ù–ù–´–ô –ê–î–ê–ü–¢–ò–í–ù–´–ô"
        ;;
    "-c"|"--current"|"" )
        show_current
        ;;
    "--help"|"-h")
        show_help
        ;;
    *)
        if [[ "${GOVERNOR}" =~ ^[0-9]+$ ]]; then
            set_frequency "${GOVERNOR}"
        else
            echo -e "${RED}√ó${NC} –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–µ–∂–∏–º: ${GOVERNOR}"
            echo -e "${YELLOW}‚Ñπ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:${NC} sudo $0 --help"
        fi
        ;;
esac
